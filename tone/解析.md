# 音色库解析
解析对象来自：https://github.com/g200kg/webaudio-tinysynth

## setAudioContext
this.
- actx=audioContext: 音频上下文
- dest: 输出
- tsdiff: actx的创建时间
- out: 增益节点，总增益
- comp: 压缩效果器。避免在多个声音同时播放并叠加在一起的时候- 产生的削波失真
- blen: 采样率的一半，即FFT数据的有效长度

- conv: 混响节点
- rev: 增益节点（作用未知）
- convBuf: 混响的脉冲响应，双声道
混响：out->conv->rev->comp->dest

- noiseBuf: 噪音的buffer，含两个buffer
out->comp->dest

- lfo: Low Frequency Oscillator，在音频合成中，`lfo`通常用于产生一个低频的波形信号，这个信号可以用来控制其他音频参数，例如音高（频率）、音量（振幅）或声像（立体声平衡）。通过这种方式，`lfo`可以用来创建各种音频效果，例如颤音（vibrato）、震音（tremolo）或自动声像（auto-panning）。
- chmod: 长16的数组，对应每个通道，每个元素是一个gain。
lfo->chmod[i]->某个的osc的detune，起调制作用

- chpan: 每个是createStereoPanner，控制左右声道
- chvol: 每个是gain
chvol[i]->chpan[i]->out

- wave: imag = [0,9,9,9,9]的wave

第二个数组`program1`定义了一系列乐器的声音参数。每个元素是一个数组，代表一个乐器的声音参数。每个参数数组包含一个或多个对象，每个对象代表一个声音波形及其相关参数。
https://g200kg.github.io/webaudio-tinysynth/soundedit.html

   - `w`：waveform
    "sine"/"sawtooth"/"square"/"triangle" (basic waveforms)
    "w9999" (summing 1-4 harmonics)
    "n0" (white noise)
    "n1" (metalic noise)
   - `v`：音量，范围通常在0到1之间。
   - `t`: tune factor according to note#
   - `g`：output destination 0=final output / n=FM to specified osc即将FM效果应用在第几个osc上

   A(H)DSR：
   - `a`：attack，攻击时间，表示声音从0增加到最大音量的时间。
   - `h`: hold，保持在最大值的时间
   - `d`：decay，衰减时间，表示声音从最大音量降到0的时间。
   - `s`：sustain，持续，表示声音在按键持续按下期间的音量。
   - `r`：release，释放时间，表示按键释放后声音消失的时间。

   - `k`：键盘跟踪，表示音高如何随键盘位置变化。volume key tracking factor。在真实的乐器中，音量往往会随着音高的变化而变化。
   - `f`：delta频率。在基频上面加的
   - `p`: pitch bend，频率变化因数(乘)
   - `q`: pitch bend speed factor，从freq到freq*p所需时间(秒)


这些参数可以用来控制合成器生成的声音的各个方面，包括音量、音调、音色等。这种方式的优点是可以通过改变参数来生成各种不同的声音，而无需录制实际的音频样本。


## init
1. `this.pg`：可能是"program"的缩写，用于存储每个MIDI通道的当前乐器（或程序）号。
2. `this.vol`：可能是"volume"的缩写，用于存储每个MIDI通道的音量级别。
3. `this.ex`：这个变量在给出的代码片段中没有被初始化，所以无法确定其含义。
4. `this.bend`：可能用于存储每个MIDI通道的弯音值。
5. `this.rpnidx`：这个变量在给出的代码片段中没有被初始化，所以无法确定其含义。
6. `this.brange`：可能是"bend range"的缩写，用于存储每个MIDI通道的弯音范围。
7. `this.sustain`：可能用于存储每个MIDI通道的延音踏板状态。
8. `this.notetab`：可能是"note table"的缩写，用于存储当前正在播放的音符的信息。
9. `this.rhythm`：是否是节奏通道。比如通道9通常用于打击乐器，则rhythm[9]=1。
10. `this.masterTuningC`，`this.masterTuningF`：可能用于存储主音调的粗调和细调值。
11. `this.tuningC`，`this.tuningF`：可能用于存储每个MIDI通道的粗调和细调值。
12. `this.scaleTuning`：可能用于存储每个MIDI通道的音阶调整值。
13. `this.maxTick`，`this.playTick`，`this.playing`：可能用于存储播放状态，包括最大的MIDI tick值，当前的tick值，以及是否正在播放。
14. `this.releaseRatio`：可能是声音释放阶段的时间比例。
15. `this.preroll`：可能是预滚动时间，用于在开始播放音符前预加载音频数据。
16. `this.relcnt`：可能是"release count"的缩写，用于计数已经释放的音符数量。

这些都是根据变量名和常见的MIDI和音频合成的概念推测的，具体的含义可能会根据代码的其他部分有所不同。

最重要的：_note
```js
nt = {
    o: [振荡器],    // detune受每个channel的chmod调制
    g: [增益],
    t: 开始的时刻,
    e: 结束的时刻,
    ch: 音轨,
    n: 音符,
    t2: attack结束的时刻,
    v: [幅度],
    r: [ahdsr的r],
    f: 基频,
}
```

detune是什么意思：以音分（1/100半音）为单位，半音的频率是相对值，区别于delta frequency

if(osc.detune)总是true
chmod的gain需要设置为非零，osc.detune也需要设置为非零，才能播放震音